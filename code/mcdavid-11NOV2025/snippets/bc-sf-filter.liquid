<script>
  /* Declare bcSfFilterConfig variable */
  var bcSfFilterMainConfig = {
    api: {
      filterUrl: 'https://services.mybcapps.com/bc-sf-filter/filter',
      searchUrl: 'https://services.mybcapps.com/bc-sf-filter/search',
      suggestionUrl: 'https://services.mybcapps.com/bc-sf-filter/search/suggest',
    },
    shop: {
      name: '{{ shop.name | escape }}',
      url: '{{ shop.url }}',
      domain: '{{ shop.permanent_domain }}',
      currency: '{{ shop.currency }}',
      money_format: '{{ shop.money_format | replace: "'", '"' | replace: "$", "&#36;" }}'
    },
    general: {
      {% if settings.custom_text != "" %}
        {% assign is_valid = true %}
        {% assign now_date = 'now' | date: '%s' %}
        {% if settings.custom_text_start_date != "" %}
          {% assign custom_text_start_date = settings.custom_text_start_date | date: '%s' %}
          {% if custom_text_start_date > now_date %}
            {% assign is_valid = false %}
          {% endif %}
        {% endif %}
        {% if settings.custom_text_end_date != "" %}
          {% assign custom_text_end_date = settings.custom_text_end_date | date: '%s' %}
          {% if custom_text_end_date < now_date %}
            {% assign is_valid = false %}
          {% endif %}
        {% endif %}
        {%- if is_valid -%}custom_text: {{ settings.custom_text | json }},{%- endif -%}
        {% if settings.custom_text_color != blank %}  custom_text_color: {{ settings.custom_text_color | json }},  {% endif %}
        {% if settings.custom_text_url != blank %}  custom_text_url: {{ settings.custom_text_url | json }},  {% endif %}
        {% if settings.custom_text_modal != blank %}  custom_text_modal: true, {% endif %}
      {% endif %}
      {% if settings.custom_text2 != "" %}
        {% assign is_valid = true %}
        {% assign now_date = 'now' | date: '%s' %}
        {% if settings.custom_text2_start_date != "" %}
          {% assign custom_text2_start_date = settings.custom_text2_start_date | date: '%s' %}
          {% if custom_text2_start_date > now_date %}
            {% assign is_valid = false %}
          {% endif %}
        {% endif %}
        {% if settings.custom_text2_end_date != "" %}
          {% assign custom_text2_end_date = settings.custom_text2_end_date | date: '%s' %}
          {% if custom_text2_end_date < now_date %}
            {% assign is_valid = false %}
          {% endif %}
        {% endif %}
        {%- if is_valid -%}custom_text2: {{ settings.custom_text2 | json }},{%- endif -%}
        {% if settings.custom_text2_color != blank %}  custom_text2_color: {{ settings.custom_text2_color | json }},  {% endif %}
        {% if settings.custom_text2_url != blank %}  custom_text2_url: {{ settings.custom_text2_url | json }},  {% endif %}
        {% if settings.custom_text2_modal != blank %}  custom_text2_modal: true, {% endif %}
      {%endif %}
      {% if settings.custom_text3 != "" %}
        {% assign is_valid = true %}
        {% assign now_date = 'now' | date: '%s' %}
        {% if settings.custom_text3_start_date != "" %}
          {% assign custom_text3_start_date = settings.custom_text3_start_date | date: '%s' %}
          {% if custom_text3_start_date > now_date %}
            {% assign is_valid = false %}
          {% endif %}
        {% endif %}
        {% if settings.custom_text3_end_date != "" %}
          {% assign custom_text3_end_date = settings.custom_text3_end_date | date: '%s' %}
          {% if custom_text3_end_date < now_date %}
            {% assign is_valid = false %}
          {% endif %}
        {% endif %}
        {%- if is_valid -%}custom_text3: {{ settings.custom_text3 | json }},{%- endif -%}
        {% if settings.custom_text3_color != blank %}  custom_text3_color: {{ settings.custom_text3_color | json }},  {% endif %}
        {% if settings.custom_text3_url != blank %}  custom_text3_url: {{ settings.custom_text3_url | json }},  {% endif %}
        {% if settings.custom_text3_modal != blank %}  custom_text3_modal: true, {% endif %}
      {%endif %}
      file_url: "{{ '' | file_url }}",
      asset_url: "{{ 'bc-sf-filter.js' | asset_url }}",
      collection_id: {{ collection.id | default: 0 }},
      collection_handle: "{{ collection.handle }}",
      {% if template contains 'collection' and collection.handle %}
      collection_count: {{ collection.products_count  }},
      {% endif %}
      collection_tags: {{ current_tags | json }},
      current_tags: {{ current_tags | json }},
      default_sort_by: "{{ collection.default_sort_by }}",
      swatch_extension: "png",
      no_image_url: "{{ 'bc-sf-filter-no-image.gif' | asset_url }}",
      search_term: "{{ search.terms | default: '' }}",
      template: "{{ template }}",
      {%- comment -%} Get currencies {%- endcomment -%}
      currencies: [
        {%- for currency in shop.enabled_currencies -%}
        {{- currency.iso_code | json -}}{%- if forloop.last != true -%},{%- endif -%}        
        {%- endfor -%}
      ],
      current_currency: {{- cart.currency.iso_code | json -}}
    },
    {% if shop.metafields.bc-sf-filter.settings != blank %}
    settings: {{ shop.metafields.bc-sf-filter.settings }},
    {% endif %}
  };
  function mergeObject(obj1, obj2){
    var obj3 = {};
    for (var attr in obj1) { obj3[attr] = obj1[attr]; }
    for (var attr in obj2) { obj3[attr] = obj2[attr]; }
    return obj3;
  }
  if (typeof bcSfFilterConfig !== 'undefined') {
    var bcSfFilterConfig = mergeObject(bcSfFilterConfig, bcSfFilterMainConfig); 
  } else {
    var bcSfFilterConfig = mergeObject({}, bcSfFilterMainConfig); 
  }
</script>

<!-- Include Resources -->
{{ 'bc-sf-filter-lib.js' | asset_url | script_tag }}
{{ 'bc-sf-search.js' | asset_url | script_tag }}

{% if template contains 'collection' %}
 {% unless template contains 'bc-original' %}
 {{ 'bc-sf-filter.js' | asset_url | script_tag }}
 {% endunless %}
{% endif %}

{% if template contains 'search' %}
 {{ 'bc-sf-filter.js' | asset_url | script_tag }}
{% endif %}

<!-- Initialize App -->
<script>
  var bcsffilter = new BCSfFilter();
  bcsffilter.init();
</script>

<!-- Initialize & Customize Filter -->
{% if template contains 'collection' %}
{% unless template contains 'bc-original' %}
<script>bcsffilter.initFilter();</script>
{% endunless %}
{% endif %}

{% if template contains 'search' %}
<script>bcsffilter.initFilter();</script>
{% endif %}

<!-- Initialize & Customize Search -->
<script>bcsffilter.initSearchBox();</script>