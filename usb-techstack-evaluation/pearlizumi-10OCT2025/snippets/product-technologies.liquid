{% liquid
  assign visible = false
  for i in (1..3)
    assign key_image = i | prepend: 'feature_technology_image_'
    assign key_heading = i | prepend: 'feature_technology_heading_'
    assign key_body = i | prepend: 'feature_technology_body_'
    assign key_link = i | prepend: 'feature_technology_link_'
    assign key_video = i | prepend: 'feature_technology_video_url_'
    if product.metafields["global"][key_image] != blank or product.metafields["global"][key_heading] != blank or product.metafields["global"][key_body] != blank or product.metafields["global"][key_link] != blank or product.metafields["global"][key_video] != blank
      assign visible = true
    endif
  endfor
%}

{% if visible %}

<div class="md:p-25 lg:pt-0 lg:px-22.5 lg:pb-33 mx-auto" style="max-width: 1380px;">
  <div class="border-t-1 border-soft-grey md:border-none py-11 md:py-0 lg:px-25">
    <h3 class="uppercase px-6 md:px-0 md:mb-21">Features & Technology</h3>
    {% for i in (1..3) %}
      {% assign key_image = i | prepend: 'feature_technology_image_' %}
      {% assign key_heading = i | prepend: 'feature_technology_heading_' %}
      {% assign key_body = i | prepend: 'feature_technology_body_' %}
      {% assign key_link = i | prepend: 'feature_technology_link_' %}
      {% assign key_video = i | prepend: 'feature_technology_video_url_' %}
      {% if product.metafields["global"][key_image] != blank or
            product.metafields["global"][key_heading] != blank or
            product.metafields["global"][key_body] != blank or
            product.metafields["global"][key_link] != blank or
            product.metafields["global"][key_video] != blank %}
        <div class="flex flex-wrap justify-between mb-12.5 md:-mx-3 md:mb-25 lg:mb-35 last:mb-0">
          <div class="w-full md:w-1/2 md:px-3 order-1">
            {% if product.metafields["global"][key_image] != blank %}
              <div class="relative pt-4/5 md:pt-[100%]">
                <img class="lazy absolute inset-0 w-full h-full object-cover" alt="{{ product.title}} " data-src="{{ product.metafields["global"][key_image] }}" loading="lazy" />
                {% if product.metafields["global"][key_video] != blank %}
                  <span class="play-video-btn bg-bright-yellow hover:bg-[faded-bright-yellow] w-8.5 h-8.5 lg:w-23.5 lg:h-23.5 rounded-full absolute top-1/2 left-1/2 cursor-pointer transform -translate-x-1/2 -translate-y-1/2 z-1" data-video-modal-id="feature_technology_video_modal_{{ product.id }}_{{ i }}" data-watch-video>
                    {%- render 'svg-play-light', classes: 'absolute z-2 top-1/2 left-1/2 cursor-pointer transform -translate-y-1/2 -translate-x-1/3 w-4 h-6 lg:w-8 lg:h-12' -%}
                  </span>
                  <div id="feature_technology_video_modal_{{ product.id }}_{{ i }}" class="cta-video-modal hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 shadow-modal max-w-1010 w-full z-50">
                    <span class="cta-video-modal__close absolute left-auto right-1 -top-14 xl:top-auto xl:bottom-full xl:right-auto xl:left-full shadow-modal rounded-full bg-white w-10 h-10 flex items-center justify-center cursor-pointer">
                      {%- render 'svg-close' -%}
                    </span>
                    <div class="cta-video-modal--inner relative h-0 w-full pt-[56.25%]">
                      <iframe class="absolute inset-0" src="{{ product.metafields["global"][key_video] }}?rel=0&version=3&showinfo=0&loop=1" width="100%" height="100%" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          </div>
          <div class="w-full md:w-2/5 p-6 md:px-3 md:py-0 xl:py-16 order-2 {% cycle 'md:order-2', 'md:order-none' %}">
            <h4 class="font-semibold mb-4">{{ product.metafields["global"][key_heading] }}</h4>
            <p class="font-normal text-p-s lg:text-p mb-7">{{ product.metafields["global"][key_body] }}</p>
            {% if product.metafields["global"][key_link] != blank %}
              <a href="{{ product.metafields["global"][key_link] }}" class="font-sora font-semibold text-special uppercase border-b-2 border-black hover:text-pine hover:border-pine{% if product.metafields["global"][key_video] != blank %} mr-4 lg:mr-6{% endif %}">Learn more</a>
            {% endif %}
            {% if product.metafields["global"][key_video] != blank %}
              <a href="javascript:void(0)" class="font-sora font-semibold text-special uppercase border-b-2 border-black hover:text-pine hover:border-pine" data-video-modal-id="feature_technology_video_modal_{{ product.id }}_{{ i }}" data-watch-video>Watch video</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

{% endif %}
