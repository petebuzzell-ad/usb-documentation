{% liquid
  if product.available
    assign current_variant = product.first_available_variant
  else
    assign current_variant = product.variants[0]
  endif

  assign promo_text = ''
  assign promo_messages = settings.promo_messages | newline_to_br | split: '<br />'
  for tag in product.tags
    if tag contains 'promo:'
      for message in promo_messages
        if message contains tag
          assign promo_text = message | remove: tag | remove: '||'
        endif
      endfor
    endif
  endfor
  if promo_text == blank
    if product.metafields["global"]["prd_promotion_text"] != blank
      assign promo_text = product.metafields["global"]["prd_promotion_text"]
    elsif current_variant.metafields["global"]["promo_text"] != blank
      assign promo_text = current_variant.metafields["global"]["promo_text"]
    endif
  endif

  assign extra_pro_discount = settings.pro_extra_discount
  assign extra_pro_discount_amount = settings.extra_pro_discount_amount
  assign pro_price = false
  if customer
    comment
      check if the customer is a Pro member
    endcomment
    unless gift_card
      assign discount_tag = false
      assign limit_tag = false
      for tag in customer.tags
        if tag contains "discount-"
          if extra_pro_discount
            assign discount_tag = tag | remove: "discount-" | plus: extra_pro_discount_amount
          else
            assign discount_tag = tag | remove: "discount-" | plus: 0
          endif
        endif
        if tag contains "limit-"
          assign limit_tag = tag | remove: "limit-" | plus: 0
        endif
      endfor

      if discount_tag and limit_tag
        assign display_price = current_variant.price | money_without_currency
        assign pro_price = 100.00 | minus: discount_tag | times: display_price
      endif
    endunless
  endif

%}

{%- if mobile -%}
  <!-- Mobile Buy Box Info -->
  <div class="px-6 xl:px-8 xl:px-0 mb-4">
    {%- comment -%} Top Row {%- endcomment -%}
    <!-- Title -->
    <h3 class="pdp-title text-center font-lato font-semibold text-grey-three tracking-normal mb-2">
      {{- product.title -}}
    </h3>

    {% if product.metafields["global"]["prd_sub_title"] != blank %}
      <div class="text-center mb-2.5">
        <p class="text-p-ms m-0">{{ product.metafields["global"]["prd_sub_title"] }}</p>
      </div>
    {% endif %}

    {%- unless gift_card -%}
      {%- comment -%} Bottom Row {%- endcomment -%}
      <div class="flex flex-col justify-center items-center mt-2 gap-2.5">

        <!-- Review Stars -->
        {% render 'bv-summary' %}

        <!-- SKU & Stock Info -->
        <div data-sku-and-stock class="flex leading-18">
          {%- if product.selected_or_first_available_variant.sku != blank -%}
            <span class="hidden md:inline-block text-p-xs text-grey-three mx-1">•</span>
            <span class="inline-block text-p-xs text-grey-three" data-sku>
              SKU #{{ product.selected_or_first_available_variant.sku -}}
            </span>
          {%- endif -%}
        </div>
      </div>
    {%- else -%}
      <div data-sku-and-stock class="hidden">
        {%- if product.selected_or_first_available_variant.sku != blank -%}
          <span class="inline-block text-p-xs text-grey-three mx-1">•</span>
          <span class="inline-block text-p-xs text-grey-three" data-sku>
            SKU #{{ product.selected_or_first_available_variant.sku -}}
          </span>
        {%- endif -%}
      </div>
    {%- endunless -%}
  </div>

{%- else-%}

  <!-- Desktop Buy Box Info -->
  <div class="hidden md:block mb-3.5">
    {%- comment -%} Top Row {%- endcomment -%}
    <!-- Title -->
    <h3 class="pdp-title text-left text-h4-m lg:text-[28px] lg:leading-9 font-lato font-semibold text-grey-three tracking-normal m-0 mb-1 lg:mb-3">
      {{- product.title -}}
    </h3>

    {%- unless gift_card -%}
      <div class="flex flex-col xl:flex-row xl:items-center mb-3">
        {%- unless storefront == "INT" -%}
          <!-- Review Stars -->
          {% render 'bv-summary' %}
        {%- endunless -%}

        <!-- SKU & Stock Info -->
        <div data-sku-and-stock class="flex leading-18">
          {%- if product.selected_or_first_available_variant.sku != blank -%}
            <span class="hidden xl:inline-block text-p-xs text-grey-three mr-3">•</span>
            <span class="inline-block text-p-xs text-grey-three" data-sku>
              SKU #{{ product.selected_or_first_available_variant.sku -}}
            </span>
          {%- endif -%}
        </div>
      </div>
    {% else %}
      <div data-sku-and-stock class="hidden">
        {%- if product.selected_or_first_available_variant.sku != blank -%}
          <span class="hidden xl:inline-block text-p-xs text-grey-three mr-3">•</span>
          <span class="inline-block text-p-xs text-grey-three" data-sku>
            SKU #{{ product.selected_or_first_available_variant.sku -}}
          </span>
        {%- endif -%}
      </div>
    {%- endunless -%}

    {%- if product.metafields.global.prd_sub_title != blank -%}
      <div class="mt-2 text-p-s xl:text-p-lg">
        {{ product.metafields.global.prd_sub_title }}
      </div>
    {%- endif -%}

    <!-- Price Container -->
    <div class="mt-3 lg:my-6 flex items-center justify-start flex-wrap">
      {%- comment -%} Clearance Pricing {%- endcomment -%}
      {% if current_variant.compare_at_price and current_variant.price < current_variant.compare_at_price %}
      <span data-product-price class="inline-block text-h4 mr-2.5 font-lato font-semibold text-on-sale tracking-normal">{{ pro_price | money }}</span>
      <span data-compare-price class="inline-block mr-2.5 text-h4 font-lato font-light line-through text-grey-four tracking-normal"></span>
      {%- comment -%} Member Pricing (clearance takes precedence) {%- endcomment -%}
      {% elsif discount_tag and limit_tag %}
      <span data-product-price class="inline-block text-h4 mr-2.5 font-lato font-semibold text-on-sale tracking-normal">{{ current_variant.price | money }}</span>
      <span data-compare-price class="inline-block mr-2.5 text-h4 font-lato font-light line-through text-grey-four tracking-normal">{{ current_variant.compare_at_price | money }}</span>
      {%- comment -%} Regular Pricing {%- endcomment -%}
      {% else %}
        <span data-product-price class="inline-block text-h4 mr-2.5 font-lato font-semibold tracking-normal text-stone">{{ current_variant.price | money }}</span>
        <span data-compare-price class="inline-block mr-2.5 text-h4 font-lato font-light line-through text-grey-four tracking-normal"></span>
      {% endif %}
      <!-- Promo Message -->
      {%- comment -%}
        Hiding Percentage Off + Promo Messaging until after all sites are launched
      {%- endcomment -%}
      <span class="inline-block font-lato font-semibold text-h4-m mt-1 text-right capitalize" data-promo-message><span data-promo-message-percent-off></span> <span data-promo-message-text>{{- promo_text | capitalize | replace: 'off', 'Off' -}}</span></span>
    </div>

    {%- if quickview -%}
      <div class="mt-5 text-p-s" id="quickviewDescription">{{- product.description | strip_html -}}</div>
    {%- endif -%}
  </div>

{%- endif -%}