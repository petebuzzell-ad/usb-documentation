{% for product in products %}
  {% assign collection_handles = product.collections | map: 'handle' %}
  {% assign variant = bold_selected_or_first_available_variant %}
{%- include 'bold-variant' with variant, output: 'none' -%}

  <div class="product-{{ product.id }} section clearfix">
    <div class="product_section js-product_section" itemscope itemtype="http://schema.org/Product">
      <link itemprop="image" href="{{ product.featured_image | image_url: width: 1200 }}" />
        <meta itemprop="description" content="{{ product.description | strip_html | replace: '"', '\"' | replace: "/", "\/" }}" />
        <div itemprop="shippingDetails" itemtype="https://schema.org/OfferShippingDetails" itemscope>
          <div itemprop="shippingRate" itemtype="https://schema.org/MonetaryAmount" itemscope>
            <meta itemprop="value" content="5.00" />
            <meta itemprop="currency" content="USD" />
          </div>
          <div itemprop="shippingDestination" itemtype="https://schema.org/DefinedRegion" itemscope>
            <meta itemprop="addressCountry" content="US" />
          </div>
          <div itemprop="deliveryTime" itemtype="https://schema.org/ShippingDeliveryTime" itemscope>
            <div itemprop="handlingTime" itemtype="https://schema.org/QuantitativeValue" itemscope>
              <meta itemprop="minValue" content="0" />
              <meta itemprop="maxValue" content="1" />
              <meta itemprop="unitCode" content="DAY" />
            </div>
            <div itemprop="transitTime" itemtype="https://schema.org/QuantitativeValue" itemscope>
              <meta itemprop="minValue" content="7" />
              <meta itemprop="maxValue" content="10" />
              <meta itemprop="unitCode" content="DAY" />
            </div>
          </div>
        </div>
        <div itemprop="hasMerchantReturnPolicy" itemtype="https://schema.org/MerchantReturnPolicy" itemscope>
          <meta itemprop="applicableCountry" content="US" />
          <meta itemprop="returnPolicyCategory" content="https://schema.org/MerchantReturnFiniteReturnWindow" />
          <meta itemprop="merchantReturnDays" content="60" />
          <meta itemprop="returnMethod" content="https://schema.org/ReturnByMail" />
          <meta itemprop="returnFees" content="https://schema.org/FreeReturn" />
        </div>
        <meta itemprop="priceValidUntil" content="{{ 'now' | date: "%s" | plus: seconds30days | date: "%Y-%m-%d" }}" />
      
        <div class="product-app-blocks">
          {%- for block in section.blocks -%}
            {% if block.type == '@app' %}
                {% render block %}
            {% endif %}
          {%- endfor -%}
        </div>
        
      <div class="product-images half">
        {% include 'product-images', image_width: 'full' %}
        <div class="banner_holder">
          {% if settings.sale_banner_enabled and bold_compare_at_price_max > bold_price %}
            <div class="sale_banner_product">{{ 'collections.general.sale' | t }}</div>
          {% endif %}
          {% if collection_handles contains 'new' %}
            <div class="new_banner_product">{{ 'collections.general.new' | t }}</div>
          {% endif %}
          {% if collection_handles contains 'pre-order' %}
            <div class="preorder_banner_product">{{ 'collections.general.pre_order' | t }}</div>
          {% endif %}
        </div>
      </div>
      <div class="product-details half">

        {% if settings.display_vendor %}
          <p class="vendor">
            <span itemprop="brand" class="vendor">{{ product.vendor | link_to_vendor }}</span>
          </p>
        {% endif %}

        {% if variant.sku != blank and settings.display_sku %}
          <p class="sku">
            <span itemprop="sku">{{ variant.sku }}</span>
          </p>
        {% endif %}
        <h1 class="product_name" itemprop="name"><a href="{{ product.url }}">{{ product.title }}</a></h1>
        <div class="feature_divider"></div>

        {% assign product_tags = product.tags | join: ' ' %}
        {% if product_tags contains 'meta-size-chart-' %}
          {% for tag in product.tags %}
            {% if tag contains 'meta-size-chart-' %}
              <a href="javascript:;" class="size_chart" data-fancybox data-src="#size-chart{{product.id}}" data-type="inline" data-no-instant>{{ 'products.product.size_chart' | t }} <span class="icon-right-arrow"></span></a>
              {% include 'popup-size-chart', product_id: product.id %}
            {% endif %}
          {% endfor %}
        {% elsif settings.size_chart != blank %}
          <a href="javascript:;" class="size_chart" data-fancybox data-src="#size-chart{{product.id}}" data-type="inline" data-no-instant>{{ 'products.product.size_chart' | t }} <span class="icon-right-arrow"></span></a>
        {% endif %}

        {% if collection_handles contains 'coming-soon' %}
          <p class="modal_price">{{ 'collections.general.coming_soon' | t }}</p>
        {% else %}
          <div class="modal_price" itemprop="offers" itemscope itemtype="http://schema.org/Offer">
<div itemprop="shippingDetails" itemtype="https://schema.org/OfferShippingDetails" itemscope>
          <div itemprop="shippingRate" itemtype="https://schema.org/MonetaryAmount" itemscope>
            <meta itemprop="value" content="5.00" />
            <meta itemprop="currency" content="USD" />
          </div>
          <div itemprop="shippingDestination" itemtype="https://schema.org/DefinedRegion" itemscope>
            <meta itemprop="addressCountry" content="US" />
          </div>
          <div itemprop="deliveryTime" itemtype="https://schema.org/ShippingDeliveryTime" itemscope>
            <div itemprop="handlingTime" itemtype="https://schema.org/QuantitativeValue" itemscope>
              <meta itemprop="minValue" content="0" />
              <meta itemprop="maxValue" content="1" />
              <meta itemprop="unitCode" content="DAY" />
            </div>
            <div itemprop="transitTime" itemtype="https://schema.org/QuantitativeValue" itemscope>
              <meta itemprop="minValue" content="7" />
              <meta itemprop="maxValue" content="10" />
              <meta itemprop="unitCode" content="DAY" />
            </div>
          </div>
        </div>
        <div itemprop="hasMerchantReturnPolicy" itemtype="https://schema.org/MerchantReturnPolicy" itemscope>
          <meta itemprop="applicableCountry" content="US" />
          <meta itemprop="returnPolicyCategory" content="https://schema.org/MerchantReturnFiniteReturnWindow" />
          <meta itemprop="merchantReturnDays" content="60" />
          <meta itemprop="returnMethod" content="https://schema.org/ReturnByMail" />
          <meta itemprop="returnFees" content="https://schema.org/FreeReturn" />
        </div>
        <meta itemprop="priceValidUntil" content="{{ 'now' | date: "%s" | plus: seconds30days | date: "%Y-%m-%d" }}" />
            <meta itemprop="priceCurrency" content="{{ shop.currency }}" />
            <meta itemprop="seller" content="{{ shop.name | escape }}" />
            <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">
            <meta itemprop="itemCondition" itemtype="http://schema.org/OfferItemCondition" content="http://schema.org/NewCondition"/>

            <span class="sold_out">{% if variant.available == false %}{{ 'products.product.sold_out' | t }}{% endif %}</span>
            <span itemprop="price" content="{{ bold_variant_price | money_without_currency | remove: "," }}" class="{% if variant.compare_at_price > bold_variant_price %}sale{% endif %}">
              <span class="current_price {% if product.available == false %}hidden{% endif %}">
                {% if bold_variant_price > 0 %}
                  <span class="money">{{ bold_variant_price | money }}</span>
                {% else %}
                  {{ settings.free_price_text }}
                {% endif %}
              </span>
            </span>
            <span class="was_price">
            {% if bold_variant_price < variant.compare_at_price and variant.available %}
              <span class="money">{{ variant.compare_at_price | money }}</span>
            {% endif %}
            </span>
          </div>

          {% include 'product-notify-me' %}
        {% endif %}

        {% if settings.product_description_position == "top" %}
          {% if settings.frontpage_display_description and product.description != blank %}
            <div class="description" itemprop="description">
              {{ product.description | split: '<!-- split -->' | first }}
            </div>
          {% endif %}
        {% endif %}

        {% if product.tags contains 'custom-text' and settings.custom_text != "" %}
          {% assign is_valid = true %}
          {% assign now_date = 'now' | date: '%s' %}
          {% if settings.custom_text_start_date != "" %}
            {% assign custom_text_start_date = settings.custom_text_start_date | date: '%s' %}
            {% if custom_text_start_date > now_date %}
              {% assign is_valid = false %}
            {% endif %}
          {% endif %}
          {% if settings.custom_text_end_date != "" %}
            {% assign custom_text_end_date = settings.custom_text_end_date | date: '%s' %}
            {% if custom_text_end_date < now_date %}
              {% assign is_valid = false %}
            {% endif %}
          {% endif %}
          {% if is_valid %}
            <div class="custom-text" {% if settings.custom_text_color != blank %}style="color: {{settings.custom_text_color}};"{% endif %}>
              {% if settings.custom_text_modal != blank %}
                <a href="#" class="open-usb-modal" data-trigger-id="custom-text">
              {% elsif settings.custom_text_url != blank %}
                <a href="{{settings.custom_text_url}}">
              {% endif %}
                {{settings.custom_text}}
              {% if settings.custom_text_modal != blank %}
                </a>
              {% elsif settings.custom_text_url != blank %}
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}
        {% if product.tags contains 'custom-text2' and settings.custom_text2 != "" %}
          {% assign is_valid = true %}
          {% assign now_date = 'now' | date: '%s' %}
          {% if settings.custom_text2_start_date != "" %}
            {% assign custom_text2_start_date = settings.custom_text2_start_date | date: '%s' %}
            {% if custom_text2_start_date > now_date %}
              {% assign is_valid = false %}
            {% endif %}
          {% endif %}
          {% if settings.custom_text2_end_date != "" %}
            {% assign custom_text2_end_date = settings.custom_text2_end_date | date: '%s' %}
            {% if custom_text2_end_date < now_date %}
              {% assign is_valid = false %}
            {% endif %}
          {% endif %}
          {% if is_valid %}
            <div class="custom-text" {% if settings.custom_text2_color != blank %}style="color: {{settings.custom_text2_color}};"{% endif %}>
              {% if settings.custom_text2_modal != blank %}
                <a href="#" class="open-usb-modal" data-trigger-id="custom-text2">
              {% elsif settings.custom_text2_url != blank %}
                <a href="{{settings.custom_text2_url}}">
              {% endif %}
                {{settings.custom_text2}}
              {% if settings.custom_text2_modal != blank %}
                </a>
              {% elsif settings.custom_text2_url != blank %}
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}
        {% if product.tags contains 'custom-text3' and settings.custom_text3 != "" %}
          {% assign is_valid = true %}
          {% assign now_date = 'now' | date: '%s' %}
          {% if settings.custom_text3_start_date != "" %}
            {% assign custom_text3_start_date = settings.custom_text3_start_date | date: '%s' %}
            {% if custom_text3_start_date > now_date %}
              {% assign is_valid = false %}
            {% endif %}
          {% endif %}
          {% if settings.custom_text3_end_date != "" %}
            {% assign custom_text3_end_date = settings.custom_text3_end_date | date: '%s' %}
            {% if custom_text3_end_date < now_date %}
              {% assign is_valid = false %}
            {% endif %}
          {% endif %}
          {% if is_valid %}
            <div class="custom-text" {% if settings.custom_text3_color != blank %}style="color: {{settings.custom_text3_color}};"{% endif %}>
              {% if settings.custom_text3_modal != blank %}
                <a href="#" class="open-usb-modal" data-trigger-id="custom-text3">
              {% elsif settings.custom_text3_url != blank %}
                <a href="{{settings.custom_text3_url}}">
              {% endif %}
                {{settings.custom_text3}}
              {% if settings.custom_text3_modal != blank %}
                </a>
              {% elsif settings.custom_text3_url != blank %}
                </a>
              {% endif %}
            </div>
          {% endif %}
        {% endif %}

        {% unless collection_handles contains 'coming-soon' %}
          <div class="js-product_section product_section">
            {% include 'product-form' with 'product' %}
          </div>
        {% endunless %}

        {% if settings.product_description_position == "bottom" %}
          {% if settings.frontpage_display_description and product.description != blank %}
           <div class="description bottom" itemprop="description">
            {{ product.description | split: '<!-- split -->' | first }}
           </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>
{% endfor %}
